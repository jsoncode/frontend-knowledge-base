# 细化章节：HTML 表单与输入（Form & Input）

---

## 一、表单基础结构

### 1. `<form>` 标签核心属性

| 属性 | 说明 | 示例 |
|------|------|------|
| `action` | 表单提交的目标 URL | `action="/submit"` |
| `method` | 提交方式（`get` / `post`） | `method="POST"` |
| `enctype` | 编码类型（影响数据格式） | `enctype="multipart/form-data"` |
| `target` | 提交后响应打开位置 | `target="_blank"` |
| `autocomplete` | 是否启用自动填充 | `autocomplete="on"` / `"off"` |
| `novalidate` | 禁用浏览器默认验证 | `novalidate` |

> 💡 **技巧**：
> - `GET` 请求将数据附加在 URL 中，适合简单查询，有长度限制。
> - `POST` 请求将数据放在请求体中，适合敏感或大量数据。
> - `enctype` 仅在 `method="post"` 时生效。

---

### 2. 常见表单元素

| 元素 | 用途 | 示例 |
|------|------|------|
| `<input>` | 文本、密码、邮箱、数字等 | `<input type="email">` |
| `<textarea>` | 多行文本输入 | `<textarea rows="5"></textarea>` |
| `<select>` + `<option>` | 下拉选择框 | `<select><option>选项</option></select>` |
| `<button>` | 提交/重置/普通按钮 | `<button type="submit">提交</button>` |
| `<fieldset>` + `<legend>` | 分组表单控件 | `<fieldset><legend>用户信息</legend></fieldset>` |
| `<label>` | 关联表单控件（提升可访问性） | `<label for="name">姓名</label>` |

> ✅ **最佳实践**：
> - 所有 `<input>` 都应有对应的 `<label>`，使用 `for` 和 `id` 关联。
> - 使用 `<fieldset>` 对逻辑相关的控件进行分组，增强语义。

---

## 二、HTML5 新增输入类型（Input Types）

| 类型 | 用途 | 设备表现 | 验证特性 |
|------|------|--------|--------|
| `email` | 邮箱输入 | 移动端弹出邮箱键盘 | 自动验证格式 |
| `tel` | 电话号码 | 弹出数字键盘 | 无自动验证（需 pattern） |
| `number` | 数字输入 | 带增减按钮 | 支持 `min`, `max`, `step` |
| `url` | 网址输入 | - | 自动验证 URL 格式 |
| `search` | 搜索框 | 可能显示清除按钮 | - |
| `range` | 滑动条 | 图形化拖拽 | 支持 `min`, `max`, `step` |
| `color` | 颜色选择器 | 弹出调色板 | 返回十六进制颜色值 |
| `date` / `time` / `datetime-local` | 日期时间选择 | 原生日历控件 | 格式自动校验 |
| `month` / `week` | 月份/周选择 | - | - |

> ✅ **使用建议**：
> - 移动端优先使用语义化输入类型，提升用户体验（如键盘适配）。
> - 老旧浏览器会降级为 `text`，需 JavaScript 兜底或 polyfill。
> - `type="number"` 不适合输入电话（可能去除前导 0），应使用 `tel` + `pattern`。

---

## 三、HTML5 新增表单属性

### 1. **验证相关属性**

| 属性 | 说明 | 示例 |
|------|------|------|
| `required` | 必填字段 | `<input required>` |
| `pattern` | 正则表达式验证 | `pattern="\d{6}"`（6位数字） |
| `min` / `max` | 数值或日期最小/最大值 | `min="0" max="100"` |
| `step` | 数值步长 | `step="0.01"`（支持小数） |
| `maxlength` / `minlength` | 字符长度限制 | `maxlength="20"` |
| `placeholder` | 输入提示文本 | `placeholder="请输入邮箱"` |
| `autofocus` | 页面加载后自动聚焦 | `autofocus` |
| `autocomplete` | 控制自动填充行为 | `autocomplete="username"` / `"new-password"` |

> 💡 **常见 autocomplete 值**：
> - `off`：关闭
> - `on`：开启
> - `name`, `email`, `tel`, `username`, `current-password`, `new-password`：提示浏览器自动填充

---

### 2. **其他实用属性**

| 属性 | 说明 |
|------|------|
| `readonly` | 只读（可提交） |
| `disabled` | 禁用（不提交） |
| `multiple` | 允许多选（如 `email`, `file`） |
| `form` | 将表单外元素关联到指定表单 | `<input form="myForm">` |
| `formaction` / `formmethod` | 覆盖表单默认提交行为（用于多个提交按钮） |

```html
<form id="userForm">
  <!-- 内部元素自动归属 -->
</form>

<input type="text" form="userForm" name="extraField">
```

---

## 四、Constraint Validation API（约束验证 API）

浏览器内置的表单验证机制，可通过 JavaScript 控制。

### 1. 核心方法与属性

| 方法/属性 | 说明 |
|---------|------|
| `checkValidity()` | 检查元素是否通过验证，返回 boolean |
| `setCustomValidity(message)` | 设置自定义验证错误信息（空字符串表示通过） |
| `validity` | 返回 `ValidityState` 对象，包含详细验证状态 |

### 2. `ValidityState` 常见属性

| 属性 | 说明 |
|------|------|
| `valueMissing` | 必填但为空 |
| `typeMismatch` | 类型不匹配（如 email 格式错） |
| `patternMismatch` | 正则不匹配 |
| `tooLong` / `tooShort` | 超出长度限制 |
| `rangeUnderflow` / `rangeOverflow` | 数值超出 min/max |
| `customError` | `setCustomValidity` 设置了错误 |

### 3. 自定义验证示例

```js
const password = document.getElementById('password');
const confirm = document.getElementById('confirm');

confirm.addEventListener('input', function () {
  if (confirm.value && confirm.value !== password.value) {
    confirm.setCustomValidity('两次密码不一致');
  } else {
    confirm.setCustomValidity('');
  }
});
```

> ✅ **技巧**：
> - 使用 `setCustomValidity('')` 清除错误，否则会一直阻塞提交。
> - 结合 `:invalid` 和 `:valid` CSS 伪类样式反馈。

---

## 五、文件上传与 FileReader API

### 1. 文件输入基础

```html
<input type="file" id="file" multiple accept=".jpg,.png,image/*">
```

| 属性 | 说明 |
|------|------|
| `multiple` | 允许多文件选择 |
| `accept` | 限制文件类型（MIME 类型或扩展名） |
| `capture` | 调用摄像头/麦克风（移动端） | `capture="user"`（前置）/ `"environment"`（后置） |

> ⚠️ 注意：
> - `accept` 仅为提示，不能替代服务端验证。
> - 文件对象通过 `input.files` 获取（`FileList` 类型）。

### 2. FileReader API 读取文件

用于在前端预览文件内容（图片、文本等）。

```js
const fileInput = document.getElementById('file');

fileInput.addEventListener('change', function (e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();

  // 读取为 Data URL（适用于图片预览）
  reader.onload = function (event) {
    const img = document.createElement('img');
    img.src = event.target.result;
    document.body.appendChild(img);
  };

  reader.readAsDataURL(file);
});
```

#### FileReader 方法：
- `readAsDataURL(file)`：读取为 base64 字符串
- `readAsText(file, encoding)`：读取为文本（可指定编码）
- `readAsArrayBuffer(file)`：读取为二进制缓冲区

> ✅ **应用场景**：
> - 图片上传前预览
> - CSV 文件解析预览
> - 大文件分片上传前校验

---

## 六、表单提交与事件控制

### 1. 提交事件流程

```js
form.addEventListener('submit', function (e) {
  e.preventDefault(); // 阻止默认提交

  if (!form.checkValidity()) {
    // 手动触发验证 UI
    form.reportValidity();
    return;
  }

  // 执行 AJAX 提交
  submitViaAjax();
});
```

### 2. 事件说明

| 事件 | 触发时机 |
|------|--------|
| `input` | 输入内容变化时（实时） |
| `change` | 元素失去焦点且值改变时（`<select>`, `checkbox` 立即触发） |
| `focus` / `blur` | 聚焦/失焦 |
| `invalid` | 验证失败时触发（可阻止默认提示） |

> 💡 技巧：
> - 使用 `input` 事件做实时校验（如密码强度）。
> - 使用 `change` 事件做提交前最终校验。

---

## 七、无障碍（Accessibility）与最佳实践

### 1. 可访问性要点

- 所有输入控件必须有 `<label>`（或 `aria-label`）
- 错误信息通过 `aria-describedby` 关联
- 使用 `role="alert"` 表示动态错误提示
- 支持键盘操作（Tab 导航、Enter 提交）

```html
<label for="email">邮箱</label>
<input 
  type="email" 
  id="email"
  aria-describedby="email-error"
  required
>
<span id="email-error" role="alert" style="color:red">
  <!-- 动态插入错误 -->
</span>
```

### 2. 安全注意事项

- 前端验证仅为用户体验，**必须服务端二次验证**
- 防止 XSS：不要将用户输入直接插入 DOM
- 敏感信息（密码）使用 `type="password"`，避免 `autocomplete="off"` 被忽略，可使用 `autocomplete="new-password"`

---

## 八、面试高频问题

1. **`<input type="number">` 和 `type="text"` with `pattern="\d*"` 有什么区别？**
   > 前者在移动端弹出数字键盘，支持 `min/max/step`，有增减按钮；后者更灵活但无原生数值控制。

2. **如何实现自定义表单验证？**
   > 使用 Constraint Validation API：`checkValidity()` + `setCustomValidity()` + `reportValidity()`。

3. **`required` 属性在哪些元素上有效？**
   > `<input>`, `<textarea>`, `<select>`。`<option>` 本身不支持。

4. **`form` 属性的作用是什么？**
   > 将表单外的控件关联到指定表单，用于复杂布局或弹窗表单。

5. **如何预览用户选择的图片？**
   > 使用 `FileReader.readAsDataURL()` 将文件转为 base64，赋值给 `<img src>`。

6. **`autocomplete="off"` 为什么有时无效？**
   > 浏览器可能忽略该属性以提升用户体验。可尝试：
   > - `autocomplete="new-password"`
   > - 使用隐藏字段干扰：`<input type="text" style="display:none">`

---

## 九、实用技巧总结

| 场景    | 推荐做法                                                                     |
|-------|--------------------------------------------------------------------------|
| 邮箱输入  | `type="email"` + `required`                                              |
| 手机号输入 | `type="tel"` + `pattern` + `inputmode="numeric"`                         |
| 密码输入  | `type="password"` + `autocomplete="current-password"` / `"new-password"` |
| 搜索框   | `type="search"` + `results` 属性（旧）                                        |
| 数字输入  | `type="number"` + `step` + `min/max`                                     |
| 日期选择  | `type="date"`（注意兼容性）或使用 DatePicker 组件                                    |
| 多行输入  | `<textarea>` 而非 `input`                                                  |
| 动态表单  | 使用 `FormData` API 收集数据                                                   |

```js
// 使用 FormData 收集表单数据（包括文件）
const formData = new FormData(form);
fetch('/submit', {
  method: 'POST',
  body: formData
});
```

---

> **总结**：  
> 表单是用户与系统交互的核心入口。资深前端应掌握：
> - 语义化表单结构设计
> - HTML5 原生验证机制与 JavaScript 扩展
> - 文件上传与预览
> - 可访问性与用户体验平衡
> - 安全边界（前端仅做提示，服务端必须验证）
